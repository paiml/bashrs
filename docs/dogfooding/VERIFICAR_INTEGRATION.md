# verificar Integration for Synthetic Testing

**Date**: 2025-11-25
**verificar Version**: v0.3.1
**bashrs Version**: v6.39.0

## Overview

This document describes the integration of verificar for synthetic bash test generation with bashrs. verificar is a Synthetic Data Factory for Domain-Specific Code Intelligence.

## Current Capabilities

### verificar Bash Generator

verificar generates synthetic bash programs with the following features:

| Feature | Supported | Example |
|---------|-----------|---------|
| Variable assignments | Yes | `x=1`, `y=hello` |
| Echo statements | Yes | `echo "$x"`, `echo hello` |
| Environment variables | Yes | `echo "$HOME"` |
| If statements | Yes | `if [ $x -eq 0 ]; then ... fi` |
| For loops | Yes | `for i in 1 2 3; do ... done` |
| Function definitions | Yes | `greet() { echo hello }` |
| Arithmetic | Yes | `result=$((1 + 2))` |
| Pipes | Yes | `echo hello \| wc -c` |

### Generation Statistics

```
Strategy: exhaustive
Max Depth: 4
Unique Programs: 33
```

## Test Results

### bashrs Lint Analysis of Synthetic Corpus

| Metric | Value |
|--------|-------|
| Total programs | 33 |
| Parse errors | 0 |
| Programs with errors | 0 |
| Programs with warnings | 13 |
| Programs with info only | 20 |

### Lint Rules Triggered

| Rule | Count | Description |
|------|-------|-------------|
| SC2148 | 33 | Tips: Add shebang to top of script |
| SC2034 | 20 | Variable assigned but never used |
| SC2154 | 7 | Variable referenced but not assigned |
| SC2086 | 7 | Quote to prevent word splitting |
| SC2047 | 6 | Quote variable in test |
| SC2134 | 6 | Consider (( )) for numeric tests |
| SC2273 | 6 | Prefer [[ ]] over [ ] |
| SC2307 | 6 | Use [[ ]] or quote variable |
| SC2046 | 5 | Quote to prevent word splitting |
| SC2233 | 4 | Various suggestions |

### Key Finding

**100% of synthetic programs parsed successfully** - bashrs correctly handles all bash constructs generated by verificar.

## Usage

### Generate Test Corpus

```bash
# Generate 33 unique bash programs (exhaustive)
cd ../verificar
cargo run --release -- generate \
    --language bash \
    --count 10000 \
    --max-depth 4 \
    --strategy exhaustive \
    --output json > corpus.json

# Alternative: Random strategy for more variety
cargo run --release -- generate \
    --language bash \
    --count 1000 \
    --max-depth 5 \
    --strategy random \
    --output json > corpus.json
```

### Test with bashrs

```bash
# Lint each program in the corpus
cd ../bashrs
for prog in /tmp/verificar_corpus/*.sh; do
    bashrs lint "$prog" --format human
done
```

### Automated Testing Script

```python
import json
import subprocess

with open('corpus.json') as f:
    programs = json.load(f)

for i, prog in enumerate(programs):
    with open(f'/tmp/prog_{i}.sh', 'w') as f:
        f.write('#!/bin/sh\n')
        f.write(prog['code'])

    result = subprocess.run(
        ['bashrs', 'lint', f'/tmp/prog_{i}.sh'],
        capture_output=True
    )
    # Analyze results...
```

## Future Enhancements

### verificar Improvements Needed

1. **More bash constructs**:
   - Case statements
   - While loops
   - Arrays
   - Here documents
   - Command substitution variations
   - Parameter expansion

2. **Larger corpus generation**:
   - Current: 33 unique programs
   - Target: 10,000+ unique programs
   - Need increased AST diversity

3. **Coverage-guided generation**:
   - Use `verificar corpus` command
   - Target specific bashrs code paths
   - Generate edge cases

### bashrs Integration

1. **Rust dev-dependency integration**:
   ```toml
   [dev-dependencies]
   verificar = { path = "../verificar" }
   ```

2. **Automated CI testing**:
   ```yaml
   - name: Run synthetic tests
     run: |
       verificar generate --language bash --count 1000 -o corpus.json
       bashrs lint corpus/*.sh
   ```

## Comparison with Other Approaches

| Approach | Programs | Coverage | Effort |
|----------|----------|----------|--------|
| Manual test cases | ~100 | Targeted | High |
| verificar synthetic | 33 (current) | Exhaustive | Low |
| verificar random | Unlimited | Random | Low |
| Fuzzing | Millions | Chaos | Medium |
| Real-world corpus | ~75 (dogfood) | Realistic | Medium |

## Conclusion

verificar provides a foundation for synthetic bash testing, though its current bash generator is limited. The 100% success rate demonstrates bashrs's robustness with valid bash syntax.

For comprehensive testing, combine:
1. verificar synthetic corpus (exhaustive coverage)
2. Real-world scripts (dogfooding)
3. Manual edge cases (targeted testing)

---

**Generated by**: bashrs + verificar integration testing
**Reproducible**: See usage examples above
