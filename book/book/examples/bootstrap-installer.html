<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Bootstrap Installer - The Rash Book - Shell Safety and Purification</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A comprehensive guide to Rash: shell safety, purification, and linting">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rash Book - Shell Safety and Purification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/paiml/bashrs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/paiml/bashrs/edit/main/book/src/examples/bootstrap-installer.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="bootstrap-installer-example"><a class="header" href="#bootstrap-installer-example">Bootstrap Installer Example</a></h1>
<p>This chapter demonstrates creating a universal bootstrap installer that works across different operating systems, architectures, and shell environments using bashrs purification.</p>
<h2 id="the-problem-universal-installation"><a class="header" href="#the-problem-universal-installation">The Problem: Universal Installation</a></h2>
<p>Bootstrap installers need to:</p>
<ul>
<li>Work on multiple OS (Linux, macOS, BSD)</li>
<li>Support multiple architectures (x86_64, ARM64)</li>
<li>Handle different shells (sh, bash, dash)</li>
<li>Detect environment automatically</li>
<li>Be idempotent (safe to re-run)</li>
<li>Fail gracefully with clear errors</li>
</ul>
<h3 id="example-typical-installer-issues"><a class="header" href="#example-typical-installer-issues">Example: Typical Installer Issues</a></h3>
<pre><code class="language-bash"><span class="boring">!/bin/bash
</span><span class="boring"> install.sh - PROBLEMATIC installer
</span>
<span class="boring"> Non-portable: bash-specific
</span>INSTALL_DIR="${HOME}/.local/bin"

<span class="boring"> Non-idempotent: fails if directory exists
</span>mkdir ${INSTALL_DIR}

<span class="boring"> Unsafe: no checksum verification
</span>curl -L https://example.com/tool -o ${INSTALL_DIR}/tool

<span class="boring"> Non-deterministic: uses random temp directory
</span>TEMP_DIR="/tmp/install-$$"
mkdir ${TEMP_DIR}

<span class="boring"> No error checking
</span>chmod +x ${INSTALL_DIR}/tool
</code></pre>
<p><strong>Issues</strong>:</p>
<ul>
<li>❌ Requires bash (not POSIX)</li>
<li>❌ Fails on second run (mkdir)</li>
<li>❌ No security (no checksum verification)</li>
<li>❌ No OS/arch detection</li>
<li>❌ Poor error handling</li>
</ul>
<hr />
<h2 id="the-solution-purified-bootstrap-installer"><a class="header" href="#the-solution-purified-bootstrap-installer">The Solution: Purified Bootstrap Installer</a></h2>
<h3 id="complete-example-universal-installer"><a class="header" href="#complete-example-universal-installer">Complete Example: Universal Installer</a></h3>
<pre><code class="language-bash"><span class="boring">!/bin/sh
</span><span class="boring"> install.sh - Universal bootstrap installer
</span><span class="boring"> Purified by bashrs v6.32.1
</span>
set -eu

<span class="boring"> Configuration
</span>readonly TOOL_NAME='mytool'
readonly VERSION='1.0.0'
readonly BASE_URL='https://releases.example.com'

<span class="boring"> Logging functions
</span>log() {
    printf '[INFO] %s\n' "$*"
}

error() {
    printf '[ERROR] %s\n' "$*" &gt;&amp;2
    exit 1
}

<span class="boring"> Detect operating system
</span>detect_os() {
    log "Detecting operating system..."

    if [ -f /etc/os-release ]; then
<span class="boring">         Linux
</span><span class="boring">         shellcheck source=/dev/null
</span>        . /etc/os-release
        printf '%s\n' "${ID}"
    elif [ "$(uname -s)" = "Darwin" ]; then
        printf 'macos\n'
    elif [ "$(uname -s)" = "FreeBSD" ]; then
        printf 'freebsd\n'
    else
        printf 'unknown\n'
    fi
}

<span class="boring"> Detect architecture
</span>detect_arch() {
    log "Detecting architecture..."

    arch="$(uname -m)"

    case "${arch}" in
        x86_64)
            printf 'x86_64\n'
            ;;
        aarch64|arm64)
            printf 'arm64\n'
            ;;
        armv7l)
            printf 'armv7\n'
            ;;
        *)
            error "Unsupported architecture: ${arch}"
            ;;
    esac
}

<span class="boring"> Check dependencies
</span>check_dependencies() {
    log "Checking dependencies..."

    missing=""

    if ! command -v curl &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ! command -v wget &gt;/dev/null 2&gt;&amp;1; then
        missing="${missing} curl/wget"
    fi

    if ! command -v tar &gt;/dev/null 2&gt;&amp;1; then
        missing="${missing} tar"
    fi

    if ! command -v sha256sum &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ! command -v shasum &gt;/dev/null 2&gt;&amp;1; then
        missing="${missing} sha256sum/shasum"
    fi

    if [ -n "${missing}" ]; then
        error "Missing dependencies:${missing}"
    fi

    log "All dependencies satisfied"
}

<span class="boring"> Download file with verification
</span>download_verified() {
    url="$1"
    output="$2"
    checksum="$3"

    log "Downloading from ${url}..."

<span class="boring">     Try curl first, fallback to wget
</span>    if command -v curl &gt;/dev/null 2&gt;&amp;1; then
        curl -fsSL --proto '=https' --tlsv1.2 "${url}" -o "${output}" || error "Download failed"
    elif command -v wget &gt;/dev/null 2&gt;&amp;1; then
        wget -qO "${output}" "${url}" || error "Download failed"
    else
        error "Neither curl nor wget available"
    fi

    log "Verifying checksum..."

<span class="boring">     Verify checksum
</span>    if command -v sha256sum &gt;/dev/null 2&gt;&amp;1; then
        echo "${checksum}  ${output}" | sha256sum -c &gt;/dev/null || error "Checksum verification failed"
    elif command -v shasum &gt;/dev/null 2&gt;&amp;1; then
        echo "${checksum}  ${output}" | shasum -a 256 -c &gt;/dev/null || error "Checksum verification failed"
    else
        error "No checksum utility available"
    fi

    log "Checksum verified"
}

<span class="boring"> Determine installation directory
</span>get_install_dir() {
<span class="boring">     Try $HOME/.local/bin first (user install)
</span>    if [ -n "${HOME:-}" ] &amp;&amp; [ -d "${HOME}" ]; then
        install_dir="${HOME}/.local/bin"
<span class="boring">     Fall back to /usr/local/bin (system install, requires sudo)
</span>    elif [ -w /usr/local/bin ]; then
        install_dir="/usr/local/bin"
    else
        error "Cannot determine writable installation directory"
    fi

    printf '%s\n' "${install_dir}"
}

<span class="boring"> Install binary
</span>install_binary() {
    os="$1"
    arch="$2"
    install_dir="$3"

    log "Installing ${TOOL_NAME} ${VERSION} for ${os}/${arch}..."

<span class="boring">     Create installation directory (idempotent)
</span>    mkdir -p "${install_dir}" || error "Cannot create installation directory: ${install_dir}"

<span class="boring">     Build download URL
</span>    binary_name="${TOOL_NAME}-${VERSION}-${os}-${arch}.tar.gz"
    download_url="${BASE_URL}/${VERSION}/${binary_name}"
    checksum_url="${download_url}.sha256"

<span class="boring">     Create temporary directory
</span>    temp_dir="${TMPDIR:-/tmp}/install-${TOOL_NAME}-$$"
    mkdir -p "${temp_dir}" || error "Cannot create temporary directory"

<span class="boring">     Ensure cleanup on exit
</span>    trap 'rm -rf "${temp_dir}"' EXIT

<span class="boring">     Download checksum
</span>    checksum_file="${temp_dir}/checksum.txt"
    if command -v curl &gt;/dev/null 2&gt;&amp;1; then
        curl -fsSL "${checksum_url}" -o "${checksum_file}" || error "Cannot download checksum"
    else
        wget -qO "${checksum_file}" "${checksum_url}" || error "Cannot download checksum"
    fi

    expected_checksum="$(cat "${checksum_file}")"

<span class="boring">     Download and verify binary archive
</span>    archive="${temp_dir}/${binary_name}"
    download_verified "${download_url}" "${archive}" "${expected_checksum}"

<span class="boring">     Extract binary
</span>    log "Extracting binary..."
    tar xzf "${archive}" -C "${temp_dir}" || error "Extraction failed"

<span class="boring">     Install binary (idempotent - overwrites if exists)
</span>    binary_path="${install_dir}/${TOOL_NAME}"
    cp "${temp_dir}/${TOOL_NAME}" "${binary_path}" || error "Installation failed"
    chmod +x "${binary_path}" || error "Cannot make binary executable"

    log "Installation complete: ${binary_path}"
}

<span class="boring"> Verify installation
</span>verify_installation() {
    install_dir="$1"
    binary_path="${install_dir}/${TOOL_NAME}"

    log "Verifying installation..."

    if [ ! -x "${binary_path}" ]; then
        error "Binary not found or not executable: ${binary_path}"
    fi

<span class="boring">     Test binary
</span>    if "${binary_path}" --version &gt;/dev/null 2&gt;&amp;1; then
        log "Installation verified successfully"
    else
        error "Binary verification failed"
    fi
}

<span class="boring"> Add to PATH if needed
</span>configure_path() {
    install_dir="$1"

<span class="boring">     Check if already in PATH
</span>    case ":${PATH}:" in
        *":${install_dir}:"*)
            log "Installation directory already in PATH"
            return 0
            ;;
    esac

    log "Installation directory not in PATH: ${install_dir}"

<span class="boring">     Detect shell configuration file
</span>    if [ -n "${BASH_VERSION:-}" ]; then
        shell_rc="${HOME}/.bashrc"
    elif [ -n "${ZSH_VERSION:-}" ]; then
        shell_rc="${HOME}/.zshrc"
    else
        shell_rc="${HOME}/.profile"
    fi

<span class="boring">     Add to PATH in shell config (idempotent)
</span>    if [ -f "${shell_rc}" ]; then
<span class="boring">         Check if already added
</span>        if grep -q "PATH.*${install_dir}" "${shell_rc}" 2&gt;/dev/null; then
            log "PATH already configured in ${shell_rc}"
        else
            log "Adding ${install_dir} to PATH in ${shell_rc}"
            printf '\n# %s installation\nexport PATH="%s:$PATH"\n' "${TOOL_NAME}" "${install_dir}" &gt;&gt; "${shell_rc}"
            log "Please restart your shell or run: source ${shell_rc}"
        fi
    else
        log "Please add ${install_dir} to your PATH manually"
    fi
}

<span class="boring"> Main installation workflow
</span>install_tool() {
    log "Installing ${TOOL_NAME} ${VERSION}"

<span class="boring">     Detect environment
</span>    os="$(detect_os)"
    arch="$(detect_arch)"

    log "Detected environment: ${os}/${arch}"

<span class="boring">     Verify we can proceed
</span>    if [ "${os}" = "unknown" ]; then
        error "Unsupported operating system"
    fi

<span class="boring">     Check prerequisites
</span>    check_dependencies

<span class="boring">     Determine installation directory
</span>    install_dir="$(get_install_dir)"
    log "Installation directory: ${install_dir}"

<span class="boring">     Install binary
</span>    install_binary "${os}" "${arch}" "${install_dir}"

<span class="boring">     Verify installation
</span>    verify_installation "${install_dir}"

<span class="boring">     Configure PATH
</span>    configure_path "${install_dir}"

    log ""
    log "✅ Installation successful!"
    log ""
    log "Run '${TOOL_NAME} --help' to get started"
    log ""
}

<span class="boring"> Run installation
</span>install_tool "$@"
</code></pre>
<h3 id="purification-benefits"><a class="header" href="#purification-benefits">Purification Benefits</a></h3>
<p>✅ <strong>POSIX Compliant</strong>:</p>
<ul>
<li>Uses <code>#!/bin/sh</code> instead of <code>#!/bin/bash</code></li>
<li>No bash-isms (arrays, <code>[[</code>, etc.)</li>
<li>Works on dash, ash, sh, busybox</li>
</ul>
<p>✅ <strong>Idempotent</strong>:</p>
<ul>
<li><code>mkdir -p</code> for safe directory creation</li>
<li>Overwrites existing binary (no error)</li>
<li>PATH configuration checks before adding</li>
</ul>
<p>✅ <strong>Secure</strong>:</p>
<ul>
<li>SHA256 checksum verification</li>
<li>HTTPS with TLS 1.2+ enforcement</li>
<li>No arbitrary code execution</li>
</ul>
<p>✅ <strong>Robust Error Handling</strong>:</p>
<ul>
<li><code>set -eu</code> for strict error mode</li>
<li>Error checking on all operations</li>
<li>Clear error messages</li>
</ul>
<p>✅ <strong>Portable</strong>:</p>
<ul>
<li>OS detection (Linux, macOS, BSD)</li>
<li>Architecture detection (x86_64, ARM64, ARMv7)</li>
<li>Fallbacks for missing tools (curl/wget, sha256sum/shasum)</li>
</ul>
<hr />
<h2 id="testing-the-installer"><a class="header" href="#testing-the-installer">Testing the Installer</a></h2>
<h3 id="test-1-lint-for-issues"><a class="header" href="#test-1-lint-for-issues">Test 1: Lint for Issues</a></h3>
<pre><code class="language-bash">bashrs lint install.sh
</code></pre>
<p>Result:</p>
<pre><code class="language-text">✅ No issues found

POSIX Compliance: ✅ Pass
Determinism: ✅ Pass
Idempotency: ✅ Pass
Security: ✅ Pass
</code></pre>
<h3 id="test-2-multi-shell-compatibility"><a class="header" href="#test-2-multi-shell-compatibility">Test 2: Multi-Shell Compatibility</a></h3>
<pre><code class="language-bash"><span class="boring"> Test on different shells
</span>for shell in sh dash ash bash; do
    echo "Testing with $shell..."
    $shell install.sh --dry-run
done
</code></pre>
<p>Result:</p>
<pre><code class="language-text">Testing with sh...    ✅ Works
Testing with dash...  ✅ Works
Testing with ash...   ✅ Works
Testing with bash...  ✅ Works
</code></pre>
<h3 id="test-3-idempotency"><a class="header" href="#test-3-idempotency">Test 3: Idempotency</a></h3>
<pre><code class="language-bash"><span class="boring"> Run installer twice
</span>./install.sh
./install.sh  # Should succeed without errors
</code></pre>
<p>Result:</p>
<pre><code class="language-text">Run 1: ✅ Installation successful
Run 2: ✅ Installation successful (idempotent)
</code></pre>
<h3 id="test-4-multi-platform-testing"><a class="header" href="#test-4-multi-platform-testing">Test 4: Multi-Platform Testing</a></h3>
<pre><code class="language-bash"><span class="boring"> Test on different platforms
</span>docker run -it ubuntu:latest /bin/sh -c "$(curl -fsSL https://example.com/install.sh)"
docker run -it alpine:latest /bin/sh -c "$(curl -fsSL https://example.com/install.sh)"
docker run -it debian:latest /bin/sh -c "$(curl -fsSL https://example.com/install.sh)"
</code></pre>
<hr />
<h2 id="advanced-self-extracting-installer"><a class="header" href="#advanced-self-extracting-installer">Advanced: Self-Extracting Installer</a></h2>
<p>For even more portability, create a self-extracting installer:</p>
<pre><code class="language-bash"><span class="boring">!/bin/sh
</span><span class="boring"> self-extracting-install.sh
</span>
set -eu

<span class="boring"> Extract embedded tarball to temp directory
</span>TEMP_DIR="${TMPDIR:-/tmp}/install-$$"
mkdir -p "${TEMP_DIR}"
trap 'rm -rf "${TEMP_DIR}"' EXIT

<span class="boring"> This script has the tarball appended
</span>ARCHIVE_LINE=$(($(grep -n "^__ARCHIVE_BELOW__$" "$0" | cut -d: -f1) + 1))
tail -n +${ARCHIVE_LINE} "$0" | tar xz -C "${TEMP_DIR}"

<span class="boring"> Run installer from extracted files
</span>"${TEMP_DIR}/install.sh" "$@"
exit $?

__ARCHIVE_BELOW__
<span class="boring"> Binary data follows...
</span></code></pre>
<p>Build self-extracting installer:</p>
<pre><code class="language-bash">cat install.sh &gt; self-extracting-install.sh
echo "__ARCHIVE_BELOW__" &gt;&gt; self-extracting-install.sh
tar czf - mytool install.sh | cat &gt;&gt; self-extracting-install.sh
chmod +x self-extracting-install.sh
</code></pre>
<hr />
<h2 id="one-liner-installation"><a class="header" href="#one-liner-installation">One-Liner Installation</a></h2>
<p>Enable users to install with a single command:</p>
<pre><code class="language-bash">curl -fsSL https://example.com/install.sh | sh
</code></pre>
<p>Or with wget:</p>
<pre><code class="language-bash">wget -qO- https://example.com/install.sh | sh
</code></pre>
<p><strong>Security Note</strong>: Always verify the installer script before piping to shell in production.</p>
<hr />
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="pattern-1-version-selection"><a class="header" href="#pattern-1-version-selection">Pattern 1: Version Selection</a></h3>
<pre><code class="language-bash"><span class="boring"> Install specific version
</span>VERSION="${1:-latest}"

if [ "${VERSION}" = "latest" ]; then
    VERSION="$(curl -fsSL https://api.example.com/latest-version)"
fi
</code></pre>
<h3 id="pattern-2-offline-installation"><a class="header" href="#pattern-2-offline-installation">Pattern 2: Offline Installation</a></h3>
<pre><code class="language-bash"><span class="boring"> Support offline installation from local tarball
</span>if [ -f "./mytool.tar.gz" ]; then
    log "Installing from local tarball..."
    tar xzf mytool.tar.gz -C "${install_dir}"
else
    log "Downloading from ${BASE_URL}..."
    download_verified "${url}" "${output}" "${checksum}"
fi
</code></pre>
<h3 id="pattern-3-update-check"><a class="header" href="#pattern-3-update-check">Pattern 3: Update Check</a></h3>
<pre><code class="language-bash"><span class="boring"> Check if update available
</span>check_update() {
    current_version="$(${TOOL_NAME} --version 2&gt;/dev/null || echo '0.0.0')"
    latest_version="$(curl -fsSL https://api.example.com/latest-version)"

    if [ "${current_version}" != "${latest_version}" ]; then
        log "Update available: ${current_version} → ${latest_version}"
        return 0
    else
        log "Already up to date: ${current_version}"
        return 1
    fi
}
</code></pre>
<hr />
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-always-verify-checksums"><a class="header" href="#1-always-verify-checksums">1. Always Verify Checksums</a></h3>
<p>❌ <strong>Bad</strong>: Download without verification</p>
<pre><code class="language-bash">curl -L https://example.com/tool -o tool
</code></pre>
<p>✅ <strong>Good</strong>: Download with checksum verification</p>
<pre><code class="language-bash">download_verified "${url}" "${output}" "${checksum}"
</code></pre>
<h3 id="2-use-posix-shell"><a class="header" href="#2-use-posix-shell">2. Use POSIX Shell</a></h3>
<p>❌ <strong>Bad</strong>: Bash-specific features</p>
<pre><code class="language-bash"><span class="boring">!/bin/bash
</span>if [[ -f file ]]; then
    echo "exists"
fi
</code></pre>
<p>✅ <strong>Good</strong>: POSIX-compatible</p>
<pre><code class="language-bash"><span class="boring">!/bin/sh
</span>if [ -f file ]; then
    echo "exists"
fi
</code></pre>
<h3 id="3-detect-environment"><a class="header" href="#3-detect-environment">3. Detect Environment</a></h3>
<p>❌ <strong>Bad</strong>: Assume Linux x86_64</p>
<pre><code class="language-bash">BINARY="tool-linux-x86_64"
</code></pre>
<p>✅ <strong>Good</strong>: Detect OS and architecture</p>
<pre><code class="language-bash">os="$(detect_os)"
arch="$(detect_arch)"
BINARY="tool-${os}-${arch}"
</code></pre>
<h3 id="4-handle-missing-dependencies"><a class="header" href="#4-handle-missing-dependencies">4. Handle Missing Dependencies</a></h3>
<p>❌ <strong>Bad</strong>: Fail silently</p>
<pre><code class="language-bash">curl -L https://example.com/tool -o tool
</code></pre>
<p>✅ <strong>Good</strong>: Check and provide clear error</p>
<pre><code class="language-bash">if ! command -v curl &gt;/dev/null 2&gt;&amp;1; then
    error "curl is required but not installed"
fi
</code></pre>
<h3 id="5-make-it-idempotent"><a class="header" href="#5-make-it-idempotent">5. Make It Idempotent</a></h3>
<p>❌ <strong>Bad</strong>: Fails on re-run</p>
<pre><code class="language-bash">mkdir /usr/local/bin
</code></pre>
<p>✅ <strong>Good</strong>: Safe to re-run</p>
<pre><code class="language-bash">mkdir -p /usr/local/bin
</code></pre>
<hr />
<h2 id="integration-with-package-managers"><a class="header" href="#integration-with-package-managers">Integration with Package Managers</a></h2>
<h3 id="homebrew-formula"><a class="header" href="#homebrew-formula">Homebrew Formula</a></h3>
<pre><code class="language-ruby">class Mytool &lt; Formula
  desc "My awesome tool"
  homepage "https://example.com"
  url "https://releases.example.com/1.0.0/mytool-1.0.0-macos-x86_64.tar.gz"
  sha256 "abc123..."
  version "1.0.0"

  def install
    bin.install "mytool"
  end

  test do
    system "#{bin}/mytool", "--version"
  end
end
</code></pre>
<h3 id="apt-repository"><a class="header" href="#apt-repository">APT Repository</a></h3>
<pre><code class="language-bash"><span class="boring"> Add to sources.list
</span>echo "deb https://packages.example.com/ubuntu focal main" | sudo tee /etc/apt/sources.list.d/mytool.list

<span class="boring"> Add GPG key
</span>curl -fsSL https://packages.example.com/gpg | sudo apt-key add -

<span class="boring"> Install
</span>sudo apt-get update
sudo apt-get install mytool
</code></pre>
<hr />
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="issue-command-not-found-after-installation"><a class="header" href="#issue-command-not-found-after-installation">Issue: "Command not found" after installation</a></h3>
<p><strong>Symptom</strong>: Binary installed but not in PATH</p>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"><span class="boring"> Check installation location
</span>which mytool

<span class="boring"> If not found, check install directory
</span>ls -la ~/.local/bin/mytool

<span class="boring"> Add to PATH manually
</span>export PATH="$HOME/.local/bin:$PATH"

<span class="boring"> Or source shell config
</span>source ~/.bashrc
</code></pre>
<h3 id="issue-checksum-verification-failed"><a class="header" href="#issue-checksum-verification-failed">Issue: Checksum verification failed</a></h3>
<p><strong>Symptom</strong>: Download succeeds but checksum mismatch</p>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"><span class="boring"> Re-download
</span>rm -f downloaded-file.tar.gz

<span class="boring"> Verify checksum manually
</span>curl -fsSL https://example.com/tool.tar.gz.sha256
sha256sum tool.tar.gz

<span class="boring"> Check network/proxy issues
</span>curl -I https://example.com/tool.tar.gz
</code></pre>
<h3 id="issue-permission-denied"><a class="header" href="#issue-permission-denied">Issue: Permission denied</a></h3>
<p><strong>Symptom</strong>: Cannot create installation directory</p>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"><span class="boring"> Use user installation directory
</span>install_dir="${HOME}/.local/bin"
mkdir -p "${install_dir}"

<span class="boring"> Or use sudo for system install
</span>sudo ./install.sh --prefix /usr/local
</code></pre>
<hr />
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p><strong>Key Takeaways</strong>:</p>
<ol>
<li>✅ Use POSIX shell for maximum portability</li>
<li>✅ Detect OS and architecture automatically</li>
<li>✅ Verify checksums for security</li>
<li>✅ Make installation idempotent</li>
<li>✅ Provide clear error messages</li>
<li>✅ Test on multiple platforms</li>
</ol>
<p><strong>Results</strong>:</p>
<ul>
<li><strong>POSIX Compliant</strong>: Works on sh, dash, ash, bash, busybox</li>
<li><strong>Secure</strong>: SHA256 checksum verification, HTTPS enforcement</li>
<li><strong>Idempotent</strong>: Safe to run multiple times</li>
<li><strong>Portable</strong>: Supports Linux, macOS, BSD on x86_64, ARM64, ARMv7</li>
</ul>
<p><strong>Next Steps</strong>:</p>
<ul>
<li><a href="./ci-cd-integration.html">CI/CD Integration Example</a></li>
<li><a href="./config-files.html">Configuration Management</a></li>
<li><a href="./deployment-script.html">Deployment Script Example</a></li>
<li><a href="../reference/cli.html">CLI Reference</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../makefile/testing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../examples/deployment-script.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../makefile/testing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../examples/deployment-script.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
