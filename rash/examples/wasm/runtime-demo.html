<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bashrs WASM Runtime Demo</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }

        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }

        h2 {
            color: #569cd6;
            margin-top: 30px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .panel {
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 15px;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            background: #1e1e1e;
            color: #d4d4d4;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .output {
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 10px;
            min-height: 300px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: background 0.2s;
        }

        button:hover {
            background: #1177bb;
        }

        button:active {
            background: #0d5a8f;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .status.success {
            background: #1a3a1a;
            border: 1px solid #4ec9b0;
            color: #4ec9b0;
        }

        .status.error {
            background: #3a1a1a;
            border: 1px solid #f48771;
            color: #f48771;
        }

        .status.info {
            background: #1a2a3a;
            border: 1px solid #569cd6;
            color: #569cd6;
        }

        .examples {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .example-btn {
            background: #3c3c3c;
            padding: 8px 12px;
            font-size: 12px;
        }

        .example-btn:hover {
            background: #4c4c4c;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .metric {
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #4ec9b0;
        }

        .metric-label {
            font-size: 12px;
            color: #858585;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>üêö bashrs WASM Runtime Demo</h1>
    <p>Execute bash scripts in your browser using WebAssembly</p>

    <div class="status info" id="loading-status">
        ‚è≥ Loading WASM module...
    </div>

    <div class="examples" id="examples">
        <button class="example-btn" onclick="loadExample('hello')">Hello World</button>
        <button class="example-btn" onclick="loadExample('variables')">Variables</button>
        <button class="example-btn" onclick="loadExample('cd-pwd')">CD & PWD</button>
        <button class="example-btn" onclick="loadExample('multi')">Multi-line</button>
        <button class="example-btn" onclick="loadExample('complex')">Complex Script</button>
    </div>

    <div class="container">
        <div class="panel">
            <h2>üìù Bash Script</h2>
            <textarea id="script-input" placeholder="Enter bash script here...">echo "Hello from WASM bash!"
name="Claude"
echo "Hello, $name!"
cd /tmp
pwd
echo "Script complete!"</textarea>
            <button onclick="executeScript()">‚ñ∂Ô∏è Execute Script</button>
            <button onclick="clearAll()">üóëÔ∏è Clear</button>
        </div>

        <div class="panel">
            <h2>üì§ Output</h2>
            <div class="output" id="output"></div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value" id="exit-code">-</div>
                    <div class="metric-label">Exit Code</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="exec-time">-</div>
                    <div class="metric-label">Execution Time</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="output-lines">-</div>
                    <div class="metric-label">Output Lines</div>
                </div>
            </div>
        </div>
    </div>

    <div class="status" id="status" style="display: none;"></div>

    <script type="module">
        import init, { execute_script } from './pkg/bashrs.js';

        // Initialize WASM
        let wasmReady = false;

        async function initWasm() {
            try {
                const startTime = performance.now();
                await init();
                const loadTime = (performance.now() - startTime).toFixed(0);
                wasmReady = true;

                const loadingStatus = document.getElementById('loading-status');
                loadingStatus.className = 'status success';
                loadingStatus.textContent = `‚úÖ WASM loaded successfully in ${loadTime}ms`;

                console.log('bashrs WASM initialized');
            } catch (e) {
                const loadingStatus = document.getElementById('loading-status');
                loadingStatus.className = 'status error';
                loadingStatus.textContent = `‚ùå Failed to load WASM: ${e}`;
                console.error('WASM initialization failed:', e);
            }
        }

        // Execute bash script
        window.executeScript = function() {
            if (!wasmReady) {
                showStatus('‚ùå WASM not ready yet', 'error');
                return;
            }

            const scriptInput = document.getElementById('script-input');
            const output = document.getElementById('output');
            const exitCodeEl = document.getElementById('exit-code');
            const execTimeEl = document.getElementById('exec-time');
            const outputLinesEl = document.getElementById('output-lines');

            const script = scriptInput.value;

            if (!script.trim()) {
                showStatus('‚ö†Ô∏è  Please enter a bash script', 'error');
                return;
            }

            try {
                const startTime = performance.now();
                const result = execute_script(script);
                const execTime = (performance.now() - startTime).toFixed(2);

                // Display output
                output.textContent = result.stdout || '(no output)';

                // Update metrics
                exitCodeEl.textContent = result.exit_code;
                exitCodeEl.style.color = result.exit_code === 0 ? '#4ec9b0' : '#f48771';
                execTimeEl.textContent = execTime + 'ms';
                outputLinesEl.textContent = (result.stdout.match(/\n/g) || []).length;

                // Show success status
                showStatus(`‚úÖ Execution complete in ${execTime}ms (exit code: ${result.exit_code})`, 'success');

                console.log('Execution result:', result);
            } catch (e) {
                output.textContent = `Error: ${e}`;
                exitCodeEl.textContent = '1';
                exitCodeEl.style.color = '#f48771';
                showStatus(`‚ùå Execution failed: ${e}`, 'error');
                console.error('Execution failed:', e);
            }
        };

        // Load example scripts
        window.loadExample = function(example) {
            const scriptInput = document.getElementById('script-input');

            const examples = {
                'hello': 'echo "Hello from WASM bash!"',
                'variables': 'name="Claude"\ngreeting="Hello"\necho "$greeting, $name!"',
                'cd-pwd': 'pwd\ncd /tmp\npwd\ncd /home\npwd',
                'multi': 'echo "Line 1"\necho "Line 2"\necho "Line 3"',
                'complex': `# Complex example
name="WASM"
version="1.0"
echo "Welcome to $name v$version"
echo "Current directory:"
pwd
echo "Changing to /tmp..."
cd /tmp
pwd
echo "Done!"`
            };

            if (examples[example]) {
                scriptInput.value = examples[example];
                showStatus(`üìã Loaded example: ${example}`, 'info');
            }
        };

        // Clear all
        window.clearAll = function() {
            document.getElementById('script-input').value = '';
            document.getElementById('output').textContent = '';
            document.getElementById('exit-code').textContent = '-';
            document.getElementById('exec-time').textContent = '-';
            document.getElementById('output-lines').textContent = '-';
            hideStatus();
        };

        // Show status message
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }

        // Initialize on load
        initWasm();

        // Enable Enter key to execute (Ctrl+Enter)
        document.getElementById('script-input').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                executeScript();
            }
        });
    </script>
</body>
</html>
